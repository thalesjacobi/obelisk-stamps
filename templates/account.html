{% extends "layout.html" %}

{% block title %}My Account - Obelisk Stamps{% endblock %}

{% block content %}
<div class="row">
    <!-- Sidebar -->
    <div class="col-md-3 mb-4">
        <div class="card">
            <div class="card-body text-center">
                <img src="/user/picture/{{ current_user.id }}" alt="Profile Picture"
                     class="rounded-circle mb-3"
                     style="width: 120px; height: 120px; object-fit: cover;"
                     onerror="this.src='https://via.placeholder.com/120?text={{ current_user.name[0] }}'">
                <h5 class="card-title mb-1">{{ current_user.name }}</h5>
            </div>
            <ul class="list-group list-group-flush">
                <li class="list-group-item active-sidebar">
                    <a href="/account" class="text-decoration-none d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-3 flex-shrink-0" viewBox="0 0 16 16">
                            <path d="M8 8a3 3 0 1 0 0-6 3 3 0 0 0 0 6m2-3a2 2 0 1 1-4 0 2 2 0 0 1 4 0m4 8c0 1-1 1-1 1H3s-1 0-1-1 1-4 6-4 6 3 6 4m-1-.004c-.001-.246-.154-.986-.832-1.664C11.516 10.68 10.289 10 8 10c-2.29 0-3.516.68-4.168 1.332-.678.678-.83 1.418-.832 1.664z"/>
                        </svg>
                        My Account
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/album" class="text-decoration-none d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-3 flex-shrink-0" viewBox="0 0 16 16">
                            <path d="M1 2.5A1.5 1.5 0 0 1 2.5 1h3A1.5 1.5 0 0 1 7 2.5v3A1.5 1.5 0 0 1 5.5 7h-3A1.5 1.5 0 0 1 1 5.5zM2.5 2a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 1h3A1.5 1.5 0 0 1 15 2.5v3A1.5 1.5 0 0 1 13.5 7h-3A1.5 1.5 0 0 1 9 5.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zM1 10.5A1.5 1.5 0 0 1 2.5 9h3A1.5 1.5 0 0 1 7 10.5v3A1.5 1.5 0 0 1 5.5 15h-3A1.5 1.5 0 0 1 1 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5zm6.5.5A1.5 1.5 0 0 1 10.5 9h3a1.5 1.5 0 0 1 1.5 1.5v3a1.5 1.5 0 0 1-1.5 1.5h-3A1.5 1.5 0 0 1 9 13.5zm1.5-.5a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5z"/>
                        </svg>
                        My Album
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/orders" class="text-decoration-none d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-3 flex-shrink-0" viewBox="0 0 16 16">
                            <path d="M0 2.5A.5.5 0 0 1 .5 2H2a.5.5 0 0 1 .485.379L2.89 4H14.5a.5.5 0 0 1 .485.621l-1.5 6A.5.5 0 0 1 13 11H4a.5.5 0 0 1-.485-.379L1.61 3H.5a.5.5 0 0 1-.5-.5M3.14 5l1.25 5h8.22l1.25-5H3.14zM5 13a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0m9-1a1 1 0 1 0 0 2 1 1 0 0 0 0-2m-2 1a2 2 0 1 1 4 0 2 2 0 0 1-4 0"/>
                        </svg>
                        My Orders
                    </a>
                </li>
                <li class="list-group-item">
                    <a href="/account/settings" class="text-decoration-none d-flex align-items-center text-muted">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-3 flex-shrink-0" viewBox="0 0 16 16">
                            <path d="M9.405 1.05c-.413-1.4-2.397-1.4-2.81 0l-.1.34a1.464 1.464 0 0 1-2.105.872l-.31-.17c-1.283-.698-2.686.705-1.987 1.987l.169.311c.446.82.023 1.841-.872 2.105l-.34.1c-1.4.413-1.4 2.397 0 2.81l.34.1a1.464 1.464 0 0 1 .872 2.105l-.17.31c-.698 1.283.705 2.686 1.987 1.987l.311-.169a1.464 1.464 0 0 1 2.105.872l.1.34c.413 1.4 2.397 1.4 2.81 0l.1-.34a1.464 1.464 0 0 1 2.105-.872l.31.17c1.283.698 2.686-.705 1.987-1.987l-.169-.311a1.464 1.464 0 0 1 .872-2.105l.34-.1c1.4-.413 1.4-2.397 0-2.81l-.34-.1a1.464 1.464 0 0 1-.872-2.105l.17-.31c.698-1.283-.705-2.686-1.987-1.987l-.311.169a1.464 1.464 0 0 1-2.105-.872l-.1-.34zM8 10.93a2.929 2.929 0 1 1 0-5.86 2.929 2.929 0 0 1 0 5.858z"/>
                        </svg>
                        Settings
                        <span class="badge bg-secondary ms-2">Coming Soon</span>
                    </a>
                </li>
                {% if is_admin %}
                <li class="list-group-item">
                    <a href="/admin" class="text-decoration-none d-flex align-items-center">
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" fill="currentColor" class="me-3 flex-shrink-0" viewBox="0 0 16 16">
                            <path d="M5 0a.5.5 0 0 1 .5.5V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2h1V.5a.5.5 0 0 1 1 0V2A2.5 2.5 0 0 1 14 4.5h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14v1h1.5a.5.5 0 0 1 0 1H14a2.5 2.5 0 0 1-2.5 2.5v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14h-1v1.5a.5.5 0 0 1-1 0V14A2.5 2.5 0 0 1 2 11.5H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2v-1H.5a.5.5 0 0 1 0-1H2A2.5 2.5 0 0 1 4.5 2V.5A.5.5 0 0 1 5 0m-.5 3A1.5 1.5 0 0 0 3 4.5v7A1.5 1.5 0 0 0 4.5 13h7a1.5 1.5 0 0 0 1.5-1.5v-7A1.5 1.5 0 0 0 11.5 3h-7zM5 6.5A1.5 1.5 0 0 1 6.5 5h3A1.5 1.5 0 0 1 11 6.5v3A1.5 1.5 0 0 1 9.5 11h-3A1.5 1.5 0 0 1 5 9.5v-3zM6.5 6a.5.5 0 0 0-.5.5v3a.5.5 0 0 0 .5.5h3a.5.5 0 0 0 .5-.5v-3a.5.5 0 0 0-.5-.5h-3z"/>
                        </svg>
                        Admin Panel
                    </a>
                </li>
                {% endif %}
            </ul>
        </div>
    </div>

    <!-- Main Content -->
    <div class="col-md-9">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">Profile Information</h4>
            </div>
            <div class="card-body">
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Name:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ current_user.name }}
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Email:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ current_user.email }}
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Username:</strong>
                    </div>
                    <div class="col-sm-9">
                        {{ current_user.username }}
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-sm-3">
                        <strong>Currency:</strong>
                    </div>
                    <div class="col-sm-9">
                        <form id="currency-form" class="d-flex align-items-center gap-2">
                            <select class="form-select form-select-sm" id="user-currency" name="currency">
                                <option value="EUR" {% if current_user.currency == 'EUR' %}selected{% endif %}>EUR - Euro</option>
                                <option value="GBP" {% if current_user.currency == 'GBP' %}selected{% endif %}>GBP - British Pound</option>
                                <option value="USD" {% if current_user.currency == 'USD' %}selected{% endif %}>USD - US Dollar</option>
                                <option value="ARS" {% if current_user.currency == 'ARS' %}selected{% endif %}>ARS - Argentine Peso</option>
                                <option value="AUD" {% if current_user.currency == 'AUD' %}selected{% endif %}>AUD - Australian Dollar</option>
                                <option value="BRL" {% if current_user.currency == 'BRL' %}selected{% endif %}>BRL - Brazilian Real</option>
                                <option value="CAD" {% if current_user.currency == 'CAD' %}selected{% endif %}>CAD - Canadian Dollar</option>
                                <option value="CHF" {% if current_user.currency == 'CHF' %}selected{% endif %}>CHF - Swiss Franc</option>
                                <option value="CNY" {% if current_user.currency == 'CNY' %}selected{% endif %}>CNY - Chinese Yuan</option>
                                <option value="CZK" {% if current_user.currency == 'CZK' %}selected{% endif %}>CZK - Czech Koruna</option>
                                <option value="DKK" {% if current_user.currency == 'DKK' %}selected{% endif %}>DKK - Danish Krone</option>
                                <option value="HUF" {% if current_user.currency == 'HUF' %}selected{% endif %}>HUF - Hungarian Forint</option>
                                <option value="INR" {% if current_user.currency == 'INR' %}selected{% endif %}>INR - Indian Rupee</option>
                                <option value="JPY" {% if current_user.currency == 'JPY' %}selected{% endif %}>JPY - Japanese Yen</option>
                                <option value="NOK" {% if current_user.currency == 'NOK' %}selected{% endif %}>NOK - Norwegian Krone</option>
                                <option value="NZD" {% if current_user.currency == 'NZD' %}selected{% endif %}>NZD - New Zealand Dollar</option>
                                <option value="PLN" {% if current_user.currency == 'PLN' %}selected{% endif %}>PLN - Polish Zloty</option>
                                <option value="SEK" {% if current_user.currency == 'SEK' %}selected{% endif %}>SEK - Swedish Krona</option>
                                <option value="TRY" {% if current_user.currency == 'TRY' %}selected{% endif %}>TRY - Turkish Lira</option>
                                <option value="ZAR" {% if current_user.currency == 'ZAR' %}selected{% endif %}>ZAR - South African Rand</option>
                            </select>
                            <button type="submit" class="btn btn-sm btn-outline-primary" id="save-currency-btn">Save</button>
                        </form>
                        <small class="text-muted">Prices across the site will be shown in this currency.</small>
                    </div>
                </div>
                <div class="row">
                    <div class="col-sm-3">
                        <strong>Account Status:</strong>
                    </div>
                    <div class="col-sm-9">
                        {% if current_user.active %}
                            <span class="badge bg-success">Active</span>
                        {% else %}
                            <span class="badge bg-danger">Inactive</span>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="card mt-4">
            <div class="card-header">
                <h4 class="mb-0">Recent Activity</h4>
            </div>
            <div class="card-body">
                <p class="text-muted mb-0">No recent activity to display.</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('currency-form');
    if (form) {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            const btn = document.getElementById('save-currency-btn');
            const currency = document.getElementById('user-currency').value;
            const originalText = btn.textContent;

            btn.disabled = true;
            btn.textContent = 'Saving...';

            fetch('/account/update-currency', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ currency: currency })
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    btn.textContent = 'Saved!';
                    btn.classList.remove('btn-outline-primary');
                    btn.classList.add('btn-success');
                    setTimeout(() => {
                        btn.textContent = originalText;
                        btn.classList.remove('btn-success');
                        btn.classList.add('btn-outline-primary');
                        btn.disabled = false;
                    }, 2000);
                } else {
                    alert(data.error || 'Failed to update currency');
                    btn.textContent = originalText;
                    btn.disabled = false;
                }
            })
            .catch(() => {
                alert('An error occurred');
                btn.textContent = originalText;
                btn.disabled = false;
            });
        });
    }
});
</script>
{% endblock %}
